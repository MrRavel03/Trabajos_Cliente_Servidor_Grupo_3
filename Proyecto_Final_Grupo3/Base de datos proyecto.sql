
DROP DATABASE IF EXISTS BIBLIOTECA_DB;
CREATE DATABASE BIBLIOTECA_DB;
USE BIBLIOTECA_DB;

CREATE TABLE ESTADO (
	ID INT PRIMARY KEY,
    DESCRIPCION VARCHAR(20) NOT NULL
);

INSERT INTO ESTADO (ID, DESCRIPCION) VALUES
(1, 'ACTIVO'),
(2, 'INACTIVO'),
(3, 'PENDIENTE'), 
(4, 'PAGADA');   

CREATE TABLE USUARIO (
	ID INT AUTO_INCREMENT PRIMARY KEY,
	NOMBRE VARCHAR(100),
    EMAIL VARCHAR(100) UNIQUE,
    PASSWORD VARCHAR(100),
    ROL ENUM('ESTUDIANTE','BIBLIOTECARIO') DEFAULT 'ESTUDIANTE',
    ID_ESTADO INT DEFAULT 1,
    FOREIGN KEY (ID_ESTADO) REFERENCES ESTADO(ID)
);

CREATE TABLE LIBRO (
	ID INT AUTO_INCREMENT PRIMARY KEY,
    TITULO VARCHAR(100),
    AUTOR VARCHAR(100),
    CATEGORIA VARCHAR(100),
    DISPONIBLE BOOLEAN DEFAULT TRUE,
    ID_ESTADO INT DEFAULT 1,
    FOREIGN KEY (ID_ESTADO) REFERENCES ESTADO(ID)
);

CREATE TABLE PRESTAMO (
	ID INT AUTO_INCREMENT PRIMARY KEY,
    ID_USUARIO INT NOT NULL,
    ID_LIBRO INT NOT NULL,
    FECHA_SALIDA DATE DEFAULT (CURRENT_DATE),
    FECHA_DEVOLUCION DATE,
    ID_ESTADO INT DEFAULT 1,
    FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID),
    FOREIGN KEY (ID_LIBRO) REFERENCES LIBRO(ID),
    FOREIGN KEY (ID_ESTADO) REFERENCES ESTADO(ID)
);

CREATE TABLE RESERVA(
	ID INT AUTO_INCREMENT PRIMARY KEY,
	ID_USUARIO INT NOT NULL,
    ID_LIBRO INT NOT NULL,
    FECHA_RESERVA DATE DEFAULT (CURRENT_DATE),
    ID_ESTADO INT DEFAULT 1,
	FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID),
    FOREIGN KEY (ID_LIBRO) REFERENCES LIBRO(ID),
    FOREIGN KEY (ID_ESTADO) REFERENCES ESTADO(ID)
);

CREATE TABLE MULTA(
	ID INT AUTO_INCREMENT PRIMARY KEY,
    ID_USUARIO INT NOT NULL,
    ID_PRESTAMO INT NOT NULL,
    MONTO DECIMAL(10,2) NOT NULL,
    FECHA_GENERACION DATE DEFAULT (CURRENT_DATE),
    ID_ESTADO INT DEFAULT 1,
	FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID),
    FOREIGN KEY (ID_PRESTAMO) REFERENCES PRESTAMO(ID),
    FOREIGN KEY (ID_ESTADO) REFERENCES ESTADO(ID)
);


-- USUARIOS
INSERT INTO USUARIO (NOMBRE, EMAIL, PASSWORD, ROL, ID_ESTADO) VALUES
('Admin Bibliotecario', 'admin@biblio.com', '1234', 'BIBLIOTECARIO', 1), -- ID 1
('Gabriel Osorio', 'gosorio@estudiante.com', '1234', 'ESTUDIANTE', 1),    -- ID 2
('Usuario Bloqueado', 'bloqueado@estudiante.com', '1234', 'ESTUDIANTE', 2); -- ID 3

-- LIBROS
INSERT INTO LIBRO (TITULO, AUTOR, CATEGORIA, DISPONIBLE, ID_ESTADO) VALUES
('Java para Principiantes', 'Gabriel Osorio', 'Tecnologia', FALSE, 1),  -- ID 1 (Prestado)
('Cien Años de Soledad', 'Gabriel Garcia Marquez', 'Novela', FALSE, 1), -- ID 2 (Prestado)
('Harry Potter', 'J.K. Rowling', 'Fantasia', FALSE, 1),                 -- ID 3 (Reservado)
('Libro Viejo y Dañado', 'Anonimo', 'Historia', FALSE, 2),              -- ID 4 (Inactivo/Basura)
('Calculo I', 'James Stewart', 'Matematicas', TRUE, 1);                 -- ID 5 (Disponible)

-- PRESTAMOS
-- Gabriel Osorio tiene prestados los libros 1 y 2
INSERT INTO PRESTAMO (ID_USUARIO, ID_LIBRO, FECHA_SALIDA, FECHA_DEVOLUCION, ID_ESTADO) VALUES
(2, 1, '2025-11-10', '2025-11-30', 1), -- Prestamo Activo Libro 1
(2, 2, '2025-11-10', '2025-11-30', 1); -- Prestamo Activo Libro 2

-- RESERVAS
-- El Admin reservó el libro 3 (Harry Potter), por eso arriba está en FALSE
INSERT INTO RESERVA (ID_USUARIO, ID_LIBRO, FECHA_RESERVA, ID_ESTADO) VALUES
(1, 3, CURRENT_DATE, 1);

-- MULTAS (Ejemplo Opcional)
-- Supongamos que hubo un prestamo anterior que generó multa
-- Insertamos un prestamo ya devuelto (ID_ESTADO 2) para asociarle una multa
INSERT INTO PRESTAMO (ID_USUARIO, ID_LIBRO, FECHA_SALIDA, FECHA_DEVOLUCION, ID_ESTADO) VALUES
(2, 5, '2025-10-01', '2025-10-20', 2); -- Prestamo ID 3 (Ya devuelto tarde)

INSERT INTO MULTA (ID_USUARIO, ID_PRESTAMO, MONTO, ID_ESTADO) VALUES
(2, 3, 1500.00, 3); -- Multa de 1500 colones pendiente para Gabriel





